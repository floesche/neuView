{% from "macros.html" import stat_card%}

<!-- Summary statistics - Full width -->
<section id="summary-stats">
    <div class="row">
        <div class="col-xs-12 col-sm-6 col-md-3">
            <div class="stat-card">
                <div class="stat-number">{{ complete_summary.total_count }}</div>
                <div class="stat-label">Total Neurons</div>
                {% if complete_summary.left_count > 0 or complete_summary.right_count > 0 %}
                <div style="font-size: 0.8em; margin-top: 5px; color: #666;">
                     Right: {{ complete_summary.right_count }} | Left: {{ complete_summary.left_count }}
                    <br><abbr title="Ln Ratio, negative numbers lean right, positive left">
                        ratio
                    </abbr>: {{ "%.2f"|format(complete_summary.cell_log_ratio) }}
                </div>
                {% endif %}
            </div>
        </div>
        <div class="col-xs-12 col-sm-6 col-md-3">
            <div class="stat-card">
                {% if soma_side == 'all' or soma_side == 'both' %}
                    <!-- B page: Show hemisphere breakdown -->
                    {% set total_synapses = complete_summary.total_post_synapses + complete_summary.total_pre_synapses %}
                    <div class="stat-number">{{ total_synapses | format_number }}</div>
                    <div class="stat-label">Total Synapses</div>
                    {% set right_synapses = complete_summary.right_pre_synapses + complete_summary.right_post_synapses %}
                    {% set left_synapses = complete_summary.left_pre_synapses + complete_summary.left_post_synapses %}
                    {% if right_synapses > 0 or left_synapses > 0 %}
                    <div style="font-size: 0.8em; margin-top: 5px; color:#666;">
                        Right: {{ right_synapses | format_number }} | Left: {{ left_synapses | format_number }}
                        <br><abbr title="Log Ratio negative numbers mean more right synapses, positive numbers more left synapses">
                            ratio
                        </abbr>: {{ "%.2f"|format(complete_summary.hemisphere_synapse_log_ratio) }}
                    </div>
                    {% endif %}
                {% else %}
                    <!-- R/M/L pages: Show side-specific synapse totals with Post/Pre breakdown -->
                    {% set total_synapses = summary.total_post_synapses + summary.total_pre_synapses %}
                    <div class="stat-number">{{ total_synapses | format_number }}</div>
                    <div class="stat-label">Total Synapses</div>
                    {% if summary.total_post_synapses > 0 or summary.total_pre_synapses > 0 %}
                    <div style="font-size: 0.8em; margin-top: 5px; color:#666;">
                        Post: {{ summary.total_post_synapses | format_number }} | Pre: {{ summary.total_pre_synapses | format_number }}

                    <br><abbr title="Log Ratio negative numbers mean more input (post-synapses), positive numbers more output (pre-synapses)">
                        ratio
                    </abbr>: {{ "%.2f"|format(summary.synapse_log_ratio) }}
                    </div>
                    {% endif %}
                {% endif %}
            </div>
        </div>
        <div class="col-xs-12 col-sm-6 col-md-3">
            <div class="stat-card">
                {% set avg_synapses = complete_summary.avg_post_synapses + complete_summary.avg_pre_synapses %}
                <div class="stat-number">{{ avg_synapses | format_number }}</div>
                <div class="stat-label">Mean Synapses</div>
                {% if complete_summary.avg_post_synapses > 0 or complete_summary.avg_pre_synapses > 0 %}
                <div style="font-size: 0.8em; margin-top: 5px; color:#666;">
                    Post: {{ complete_summary.avg_post_synapses | format_number }} | Pre: {{ complete_summary.avg_pre_synapses | format_number }}
                <br><abbr title="Log Ratio negative numbers mean more input (post-synapses), positive numbers more output (pre-synapses)">
                    ratio
                </abbr>: {{ "%.2f"|format(complete_summary.synapse_log_ratio) }}
                </div>

                {% endif %}
            </div>
        </div>
        <div class="col-xs-12 col-sm-6 col-md-3">
            <div class="stat-card">
                <div class="stat-number">{{ complete_summary.consensus_nt | abbreviate_neurotransmitter | safe}}</div>
                <div class="stat-label">Neurotransmitter</div>
                {% if complete_summary.consensus_nt != complete_summary.celltype_predicted_nt %}
                <div>Predicted: {{ complete_summary.celltype_predicted_nt | abbreviate_neurotransmitter | safe}}</div>
                {% endif %}
                {% if complete_summary.celltype_total_nt_predictions %}
                <div style="font-size: 0.8em; margin-top:5px; color:#666;">
                    Predictions: {{ complete_summary.celltype_total_nt_predictions | format_number }}
                    {% if complete_summary.celltype_predicted_nt_confidence %} <abbr title="Confidence for neurotransmitter prediction">({{ (complete_summary.celltype_predicted_nt_confidence*100) | format_percentage}})</abbr> {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    {#
    {% if summary.cell_class or summary.cell_subclass or summary.cell_superclass %}
    <div class="classification-info">
      {% if summary.cell_superclass %}
      <span class="cell-superclass" title="Cell superclass">
        <strong>Superclass:</strong> {{ summary.cell_superclass }}
      </span>
      {% endif %}
      {% if summary.cell_class %}
      <span class="cell-class" title="Cell class">
        <strong>Class:</strong> {{ summary.cell_class }}
      </span>
      {% endif %}
      {% if summary.cell_subclass %}
      <span class="cell-subclass" title="Cell subclass">
        <strong>Subclass:</strong> {{ summary.cell_subclass }}
      </span>
      {% endif %}
    </div>
    {% endif %}
    #}
</section>
