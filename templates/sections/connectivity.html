<!-- Connections - Side by side layout -->
{%- if connectivity and (connectivity.upstream or connectivity.downstream) -%}

<style>
  .partner-cell {display: inline-flex; align-items: center; }
    table.dataTable#upstream-table thead > tr > th:first-child,
    table.dataTable#upstream-table tbody > tr > td:first-child,
    table.dataTable#downstream-table thead > tr > th:first-child,
    table.dataTable#downstream-table tbody > tr > td:first-child {
    padding-left: 0px !important;
    padding-bottom: 0px !important;
    padding-top: 5px !important; 
    }
</style>

<section id="sec-connectivity">
    <h2>Connectivity</h2>
    <div class="row">
        <!-- Upstream Connections -->
        {%- if connectivity.upstream -%}
        <div class="col-xs-12 col-md-6">
            <h3 title="Neuron types that provide input to {{ neuron_data.type -}}">Inputs</h3>
            <div class="data-table">
                <table id="upstream-table" class="display">
                    <thead>
                        <tr>
                            <th>upstream<br />partner</th>
                            <th title="neurotransmitter">NT</th>
                            <th title="total connections">&sum;<br/>conns.</th>
                            <th title="connections per {{ neuron_data.type -}}">
                                <span style="text-decoration:underline #333 2px; text-underline-offset: 0.4em;">conns</span><br /> {{- neuron_data.type -}}
                            </th>
                            <th title="Percentage of Input">%<br/>In</th>
                            <th title="Cumulative Percentage">Cum.<br /> %</th>
                        </tr>
                    </thead>
                    <tbody>
                        {%- for partner in connectivity.upstream -%}
                        <tr id="u{{ loop.index0 }}">
                            <td><label class="partner-cell">
                                <input
                                type="checkbox"
                                class="partner-toggle"
                                data-direction="upstream"
                                data-partner-name='{{ partner.get("type","Unknown") | tojson }}'
                                aria-label="Toggle {{ partner.get('type','Unknown') }}"
                                />
                                <strong>{{- partner.get('type', 'Unknown') | neuron_link(partner.get('soma_side')) | safe -}}</strong>
                                </label>
                            </td>
                            <td>{{- partner.get('neurotransmitter', 'Unknown') | abbreviate_neurotransmitter | safe -}}</td>
                            <td>{{- partner.get('weight', 0) | format_conn_count | safe -}}</td>
                            <td>{{- partner.get('connections_per_neuron', 0) | format_conn_count | safe -}}</td>
                            <td style="background: linear-gradient(90deg, #fee395 {{partner.get('percentage', 0) | format_percentage}}, transparent {{partner.get('percentage', 0)|format_percentage}}) no-repeat center;" title="{{ partner.get('percentage', 0) }}%">{{- partner.get('percentage', 0)|format_percentage -}}</td>
                            <td class="cumulative-percent">0</td>
                        </tr>
                        {%- endfor -%}
                    </tbody>
                </table>
            </div>
        </div>
        {%- endif -%}

        <!-- Downstream Connections -->
        {%- if connectivity.downstream -%}
        <div class="col-xs-12 col-md-6">
            <h3 tite="Neuron types that receive output from {{ neuron_data.type -}}">Outputs</h3>

            <div class="data-table">
                <table id="downstream-table" class="display">
                    <thead>
                        <tr>
                            <th>downstream<br/>partner</th>
                            <th title="neurotransmitter">NT</th>
                            <th title="total connections">&sum;<br/>conns.</th>
                            <th title="connections per {{- neuron_data.type -}}">
                                <span style="text-decoration:underline #333 2px; text-underline-offset: 0.4em;">conns</span><br /> {{- neuron_data.type -}}
                            </th>
                            <th title="Percentage of Input">%<br/>Out</th>
                            <th title="Cumulative Percentage">Cum.<br /> %</th>
                        </tr>
                    </thead>
                    <tbody>
                        {%- for partner in connectivity.downstream
                        -%}
                        <tr id="d{{ loop.index0 }}">
                            <td><label class="partner-cell">
                                <input
                                type="checkbox"
                                class="partner-toggle"
                                data-direction="downstream"
                                data-partner-name='{{ partner.get("type","Unknown") | tojson }}'
                                aria-label="Toggle {{ partner.get('type','Unknown') }}"
                                />
                                <strong>{{- partner.get('type', 'Unknown') | neuron_link(partner.get('soma_side')) | safe -}}</strong>
                                </label>
                            </td>
                            <td>{{- partner.get('neurotransmitter', 'Unknown') | abbreviate_neurotransmitter | safe -}}</td>
                            <td>{{- partner.get('weight', 0) | format_conn_count | safe-}}</td>
                            <td>{{- partner.get('connections_per_neuron', 0) | format_conn_count | safe -}}</td>
                            <td style="background: linear-gradient(90deg, #69d0e4 {{partner.get('percentage', 0) | format_percentage}}, transparent {{partner.get('percentage', 0)|format_percentage}}) no-repeat center;" title="{{ partner.get('percentage', 0) }}%">{{- partner.get('percentage', 0)|format_percentage -}}</td>
                            <td class="cumulative-percent">0</td>
                        </tr>
                        {%- endfor -%}
                    </tbody>
                </table>
            </div>
        </div>
        {%- endif -%}
    </div>
</section>
{%- endif -%}
