<!-- Population spatial coverage for single soma side -->
<!-- Use consistent region_side keys -->

<!-- Synapse Density Row -->
<div class="row">
        {%- for region in ['ME', 'LO', 'LOP'] -%}
        {%- for side in ['L', 'R'] -%}
        {%- set region_side_key = region + '_' + side -%}
        {%- if column_analysis.comprehensive_region_grids.get(region_side_key) -%}
        <div class="col-md-4 col-sm-6 col-xs-12">
            {%- if column_analysis.comprehensive_region_grids[region_side_key].synapse_density -%}
            {%- if column_analysis.comprehensive_region_grids[region_side_key].synapse_density | is_png_data -%}
            <img src="{{ column_analysis.comprehensive_region_grids[region_side_key].synapse_density }}" alt="Complete Synapse Density Grid for {{ region }} ({{ side }})" class="grid-image" />
            {%- elif column_analysis.comprehensive_region_grids[region_side_key].synapse_density.endswith('.png') -%}
            <img src="{{ column_analysis.comprehensive_region_grids[region_side_key].synapse_density }}" alt="Complete Synapse Density Grid for {{ region }} ({{ side }})" class="grid-image" />
            {%- elif column_analysis.comprehensive_region_grids[region_side_key].synapse_density.endswith('.svg') -%}
            <object data="{{ column_analysis.comprehensive_region_grids[region_side_key].synapse_density }}" type="image/svg+xml" class="grid-image">
                <img src="{{ column_analysis.comprehensive_region_grids[region_side_key].synapse_density }}" alt="Complete Synapse Density Grid for {{ region }} ({{ side }})" />
            </object>
            {%- else -%}
            {{ column_analysis.comprehensive_region_grids[region_side_key].synapse_density | safe }}
            {%- endif -%}
            {%- endif -%}
        </div>
        {%- endif -%}
        {%- endfor -%}
        {%- endfor -%}
</div>

<!-- Cell Count Row -->
<div class="row">
        {%- for region in ['ME', 'LO', 'LOP'] -%}
        {%- for side in ['L', 'R'] -%}
        {%- set region_side_key = region + '_' + side -%}
        {%- if column_analysis.comprehensive_region_grids.get(region_side_key) -%}
        <div class="col-md-4 col-sm-6 col-xs-12">
            {%- if column_analysis.comprehensive_region_grids[region_side_key].cell_count -%}
            {%- if column_analysis.comprehensive_region_grids[region_side_key].cell_count | is_png_data -%}
            <img src="{{ column_analysis.comprehensive_region_grids[region_side_key].cell_count }}" alt="Complete Cell Count Grid for {{ region }} ({{ side }})" class="grid-image" />
            {%- elif column_analysis.comprehensive_region_grids[region_side_key].cell_count.endswith('.png') -%}
            <img src="{{ column_analysis.comprehensive_region_grids[region_side_key].cell_count }}" alt="Complete Cell Count Grid for {{ region }} ({{ side }})" class="grid-image" />
            {%- elif column_analysis.comprehensive_region_grids[region_side_key].cell_count.endswith('.svg') -%}
            <object data="{{ column_analysis.comprehensive_region_grids[region_side_key].cell_count }}" type="image/svg+xml" class="grid-image">
                <img src="{{ column_analysis.comprehensive_region_grids[region_side_key].cell_count }}" alt="Complete Cell Count Grid for {{ region }} ({{ side }})" />
            </object>
            {%- else -%}
            {{ column_analysis.comprehensive_region_grids[region_side_key].cell_count | safe }}
            {%- endif -%}
            {%- else -%}
            <p class="no-data-text">No comprehensive cell count data available</p>
            {%- endif -%}
        </div>
        {%- endif -%}
        {%- endfor -%}
        {%- endfor -%}
</div>
